{"version":3,"sources":["../../src/eth-scan.test.ts"],"names":["deployContract","deployMockContract","loadFixture","waffle","fixture","signers","provider","signer","contract","BalanceScannerArtifact","token","ERC20Artifact","abi","addresses","Promise","all","slice","map","s","getAddress","describe","it","balances","ethers","contractAddress","address","balance","BigInt","getBalance","toHexString","expect","toBe","mock","balanceOf","returns","not","toThrow","tokenA","tokenB","Object","keys","toHaveLength"],"mappings":"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","sourcesContent":["import { waffle, ethers } from '@nomiclabs/buidler';\nimport { MockContract, MockProvider } from 'ethereum-waffle';\nimport { Signer } from 'ethers';\nimport ERC20Artifact from 'openzeppelin-solidity/build/contracts/IERC20.json';\nimport BalanceScannerArtifact from '../artifacts/BalanceScanner.json';\nimport { BalanceScanner } from './contracts/BalanceScanner';\nimport { getEtherBalances, getTokenBalances, getTokensBalance, getTokensBalances } from './eth-scan';\n\nconst { deployContract, deployMockContract, loadFixture } = waffle;\n\n// eslint-disable-next-line jest/no-export\nexport const fixture = async (\n  signers: Signer[],\n  provider: MockProvider\n): Promise<{\n  contract: BalanceScanner;\n  signers: Signer[];\n  addresses: string[];\n  provider: MockProvider;\n  token: MockContract;\n}> => {\n  const signer = signers[0];\n  const contract = (await deployContract(signer, BalanceScannerArtifact)) as BalanceScanner;\n  const token = (await deployMockContract(signer, ERC20Artifact.abi)) as MockContract;\n\n  const addresses = await Promise.all(signers.slice(1).map((s) => s.getAddress()));\n\n  return { contract, signers, addresses, provider, token };\n};\n\ndescribe('eth-scan', () => {\n  describe('getEtherBalances', () => {\n    it('returns the ether balances for multiple addresses as a BalanceMap', async () => {\n      const { contract, addresses } = await loadFixture(fixture);\n\n      const balances = await getEtherBalances(ethers.provider, addresses, { contractAddress: contract.address });\n      for (const address of addresses) {\n        const balance = BigInt((await ethers.provider.getBalance(address)).toHexString());\n        expect(balance).toBe(balances[address]);\n      }\n    });\n  });\n\n  describe('getTokenBalances', () => {\n    it('returns the token balances of one token, for multiple addresses', async () => {\n      const { contract, addresses, token } = await loadFixture(fixture);\n      await token.mock.balanceOf.returns('1000');\n\n      const balances = await getTokenBalances(ethers.provider, addresses, token.address, {\n        contractAddress: contract.address\n      });\n      for (const address of addresses) {\n        expect(balances[address]).toBe(1000n);\n      }\n    });\n\n    it('does not throw for invalid contracts', async () => {\n      const { contract, addresses, token } = await loadFixture(fixture);\n\n      await expect(() =>\n        getTokenBalances(ethers.provider, addresses, token.address, { contractAddress: contract.address })\n      ).not.toThrow();\n    });\n  });\n\n  describe('getTokensBalances', () => {\n    it('returns multiple token balances, for multiple addresses', async () => {\n      const { contract, signers, addresses } = await loadFixture(fixture);\n      const tokenA = (await deployMockContract(signers[0], ERC20Artifact.abi)) as MockContract;\n      await tokenA.mock.balanceOf.returns('1000');\n\n      const tokenB = (await deployMockContract(signers[0], ERC20Artifact.abi)) as MockContract;\n      await tokenB.mock.balanceOf.returns('1');\n\n      const balances = await getTokensBalances(ethers.provider, addresses, [tokenA.address, tokenB.address], {\n        contractAddress: contract.address\n      });\n      for (const address of addresses) {\n        expect(Object.keys(balances[address])).toHaveLength(2);\n        expect(Object.keys(balances[address])[0]).toBe(tokenA.address);\n        expect(Object.keys(balances[address])[1]).toBe(tokenB.address);\n        expect(balances[address][tokenA.address]).toBe(1000n);\n        expect(balances[address][tokenB.address]).toBe(1n);\n      }\n    });\n\n    it('does not throw for invalid contracts', async () => {\n      const { contract, signers, addresses } = await loadFixture(fixture);\n      const tokenA = (await deployMockContract(signers[0], ERC20Artifact.abi)) as MockContract;\n      const tokenB = (await deployMockContract(signers[0], ERC20Artifact.abi)) as MockContract;\n\n      await expect(() =>\n        getTokensBalances(ethers.provider, addresses, [tokenA.address, tokenB.address], {\n          contractAddress: contract.address\n        })\n      ).not.toThrow();\n    });\n  });\n\n  describe('getTokensBalance', () => {\n    it('returns multiple token balances for a single address', async () => {\n      const { contract, signers, addresses } = await loadFixture(fixture);\n      const tokenA = (await deployMockContract(signers[0], ERC20Artifact.abi)) as MockContract;\n      await tokenA.mock.balanceOf.returns('1000');\n\n      const tokenB = (await deployMockContract(signers[0], ERC20Artifact.abi)) as MockContract;\n      await tokenB.mock.balanceOf.returns('1');\n\n      const balances = await getTokensBalance(ethers.provider, addresses[0], [tokenA.address, tokenB.address], {\n        contractAddress: contract.address\n      });\n      expect(Object.keys(balances)).toHaveLength(2);\n      expect(Object.keys(balances)[0]).toBe(tokenA.address);\n      expect(Object.keys(balances)[1]).toBe(tokenB.address);\n      expect(balances[tokenA.address]).toBe(1000n);\n      expect(balances[tokenB.address]).toBe(1n);\n    });\n\n    it('does not throw for invalid contracts', async () => {\n      const { contract, signers, addresses } = await loadFixture(fixture);\n      const tokenA = (await deployMockContract(signers[0], ERC20Artifact.abi)) as MockContract;\n      const tokenB = (await deployMockContract(signers[0], ERC20Artifact.abi)) as MockContract;\n\n      await expect(() =>\n        getTokensBalance(ethers.provider, addresses[0], [tokenA.address, tokenB.address], {\n          contractAddress: contract.address\n        })\n      ).not.toThrow();\n    });\n  });\n});\n"],"file":"eth-scan.test.js"}